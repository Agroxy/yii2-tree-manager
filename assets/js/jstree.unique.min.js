!function(e){"use strict";"function"==typeof define&&define.amd?define("jstree.unique",["jquery","jstree"],e):"object"==typeof exports?e(require("jquery"),require("jstree")):e(jQuery,jQuery.jstree)}(function(e,t,i){"use strict";e.jstree.plugins.unique||(e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(t,r){this.check=function(t,i,n,s,a){if(r.check.call(this,t,i,n,s,a)===!1)return!1;if(i=i&&i.id?i:this.get_node(i),n=n&&n.id?n:this.get_node(n),!n||!n.children)return!0;var d,o,u="rename_node"===t?s:i.text,c=[],h=this.settings.unique.case_sensitive,l=this._model.data;for(d=0,o=n.children.length;o>d;d++)c.push(h?l[n.children[d]].text:l[n.children[d]].text.toLowerCase());switch(h||(u=u.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return d=-1===e.inArray(u,c)||i.text&&i.text[h?"toString":"toLowerCase"]()===u,d||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+u+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:i&&i.id?i.id:!1,par:n&&n.id?n.id:!1})}),d;case"create_node":return d=-1===e.inArray(u,c),d||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+u+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:i&&i.id?i.id:!1,par:n&&n.id?n.id:!1})}),d;case"copy_node":return d=-1===e.inArray(u,c),d||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+u+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:i&&i.id?i.id:!1,par:n&&n.id?n.id:!1})}),d;case"move_node":return d=i.parent===n.id||-1===e.inArray(u,c),d||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+u+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:i&&i.id?i.id:!1,par:n&&n.id?n.id:!1})}),d}return!0},this.create_node=function(t,n,s,a,d){if(!n||n.text===i){if(null===t&&(t="#"),t=this.get_node(t),!t)return r.create_node.call(this,t,n,s,a,d);if(s=s===i?"last":s,!s.toString().match(/^(before|after)$/)&&!d&&!this.is_loaded(t))return r.create_node.call(this,t,n,s,a,d);n||(n={});var o,u,c,h,l,_=this._model.data,f=this.settings.unique.case_sensitive,g=this.settings.unique.duplicate;for(u=o=this.get_string("New node"),c=[],h=0,l=t.children.length;l>h;h++)c.push(f?_[t.children[h]].text:_[t.children[h]].text.toLowerCase());for(h=1;-1!==e.inArray(f?u:u.toLowerCase(),c);)u=g.call(this,o,++h).toString();n.text=u}return r.create_node.call(this,t,n,s,a,d)}})});